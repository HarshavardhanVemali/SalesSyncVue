<template>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <div class="login-container-div">
        <div class="animation">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 400" width="100%" height="300" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);"><defs><clipPath id="__lottie_element_3"><rect width="1440" height="400" x="0" y="0"></rect></clipPath><linearGradient id="__lottie_element_7" spreadMethod="pad" gradientUnits="userSpaceOnUse" x1="-57.21099853515625" y1="62.659000396728516" x2="-55.96900177001953" y2="-46.784000396728516"><stop offset="0%" stop-color="rgb(7,142,251)" stop-opacity="1"></stop><stop offset="50%" stop-color="rgb(4,71,125)" stop-opacity="0.5"></stop><stop offset="100%" stop-color="rgb(0,0,0)" stop-opacity="0"></stop></linearGradient><linearGradient id="__lottie_element_11" spreadMethod="pad" gradientUnits="userSpaceOnUse" x1="-66.88300323486328" y1="54.8120002746582" x2="-69.93800354003906" y2="-49.09400177001953"><stop offset="16%" stop-color="rgb(172,135,235)" stop-opacity="1"></stop><stop offset="58%" stop-color="rgb(86,68,118)" stop-opacity="0.5"></stop><stop offset="100%" stop-color="rgb(0,0,0)" stop-opacity="0"></stop></linearGradient><linearGradient id="__lottie_element_15" spreadMethod="pad" gradientUnits="userSpaceOnUse" x1="-86.58100128173828" y1="48.266998291015625" x2="-88.02100372314453" y2="-45.03099822998047"><stop offset="16%" stop-color="rgb(7,142,251)" stop-opacity="1"></stop><stop offset="58%" stop-color="rgb(4,71,125)" stop-opacity="0.5"></stop><stop offset="100%" stop-color="rgb(0,0,0)" stop-opacity="0"></stop></linearGradient><linearGradient id="__lottie_element_19" spreadMethod="pad" gradientUnits="userSpaceOnUse" x1="19.93000030517578" y1="79.22699737548828" x2="23.209999084472656" y2="-88.46900177001953"><stop offset="0%" stop-color="rgb(172,135,235)" stop-opacity="1"></stop><stop offset="50%" stop-color="rgb(86,68,118)" stop-opacity="0.5"></stop><stop offset="100%" stop-color="rgb(0,0,0)" stop-opacity="0"></stop></linearGradient></defs><g clip-path="url(#__lottie_element_3)"><g transform="matrix(1,0,0,1,1248,121)" opacity="0.5" style="display: block;"><g opacity="1" transform="matrix(1,0,0,1,0,0)"><path stroke="url(#__lottie_element_19)" stroke-linecap="round" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke-opacity="1" stroke-width="2" d=" M162.77699279785156,157.5290069580078 C160.96499633789062,172.35800170898438 148.31500244140625,183.85899353027344 133,183.85899353027344 C133,183.85899353027344 74.45500183105469,183.85899353027344 74.45500183105469,183.85899353027344 C57.89800262451172,183.85899353027344 44.45500183105469,170.41600036621094 44.45500183105469,153.85899353027344 C44.45500183105469,153.85899353027344 44.45500183105469,98 44.45500183105469,98 C44.45500183105469,81.44300079345703 31.012001037597656,68 14.455001831054688,68 C14.455001831054688,68 -313.5639953613281,68 -313.5639953613281,68 C-330.1210021972656,68 -343.5639953613281,54.55699920654297 -343.5639953613281,38 C-343.5639953613281,38 -343.5639953613281,-28.524999618530273 -343.5639953613281,-92.80400085449219"></path></g></g><g transform="matrix(-1,0,0,1,163,64)" opacity="0.5" style="display: block;"><g opacity="1" transform="matrix(1,0,0,1,0,0)"><path stroke="url(#__lottie_element_15)" stroke-linecap="round" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke-opacity="1" stroke-width="2" d=" M96,-312.4419860839844 C96,-80.30000305175781 96,139.71800231933594 96,139.71800231933594 C96,152.96360778808594 85.24559783935547,163.71800231933594 72,163.71800231933594 C72,163.71800231933594 -132.56399536132812,163.71800231933594 -132.56399536132812,163.71800231933594 C-145.80960083007812,163.71800231933594 -156.56399536132812,152.96360778808594 -156.56399536132812,139.71800231933594 C-156.56399536132812,139.71800231933594 -156.56399536132812,86 -156.56399536132812,86 C-156.56399536132812,72.75440216064453 -167.31838989257812,62.002525329589844 -180.56399536132812,62.00563430786133 C-180.56399536132812,62.00563430786133 -396.7049865722656,62.056365966796875 -396.7049865722656,62.056365966796875 C-399.8489990234375,62.05699920654297 -402.8559875488281,61.45199966430664 -405.6159973144531,60.35100173950195"></path></g></g><g transform="matrix(-1,0,0,1,131,74)" opacity="0.5" style="display: none;"><g opacity="1" transform="matrix(1,0,0,1,0,0)"><path stroke="url(#__lottie_element_11)" stroke-linecap="round" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke-opacity="1" stroke-width="2" d=" M-366.4230041503906,-153.3179931640625 C-366.4230041503906,-160.07000732421875 -366.4230041503906,-164 -366.4230041503906,-164"></path></g></g><g transform="matrix(1,0,0,1,1263,66)" opacity="0.5" style="display: none;"><g opacity="1" transform="matrix(1,0,0,1,0,0)"><path stroke="url(#__lottie_element_7)" stroke-linecap="round" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke-opacity="1" stroke-width="2" d=" M-443.7049865722656,-300.739013671875 C-443.7049865722656,-310.47100830078125 -443.7049865722656,-316 -443.7049865722656,-316"></path></g></g></g></svg>
        </div>
        <div class="login-container">
            <h2 style="color: #fff;">Login</h2>
            <p v-if="errorMessage" class="error-message">{{ errorMessage }}</p>
            <form @submit.prevent="submitLogin">
                <div class="form-group">
                    <input type="text" id="username" name="username" v-model="username" placeholder="Username" required>
                    <span class="username-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                        <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                        </svg>
                    </span>
                </div>
                <div class="form-group">
                    <input type="password" id="password" name="password" v-model="password" placeholder="Password" required>
                    <span class="toggle-password" @click="togglePasswordVisibility">
                        <i :class="passwordVisible ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                    </span>
                </div>
                <div class="forgot-password">
                    <label style="color: #fff;">
                        <input type="checkbox" v-model="rememberMe"> Remember Me
                    </label>
                    <a href="#">Forgot password?</a> </div>
                    <button type="submit" class="btn-login" :disabled="!isValid">Login</button>
            </form>
        </div>
    </div>
</template>
    
<script>
    import api from '../axios'; // Import the axios instance

    export default {
        data() {
            return {
                username: '',
                password: '',
                rememberMe: false,
                errorMessage: null,
                passwordVisible: false
            };
        },
        computed: {
            isValid() {
                return this.username.trim() !== '' && this.password.trim() !== '';
            }
        },
        methods: {
            togglePasswordVisibility() {
                this.passwordVisible = !this.passwordVisible;
                const passwordField = document.getElementById('password');
                passwordField.type = this.passwordVisible ? 'text' : 'password';
            },
            async submitLogin() {
                try {
                    const response = await api.post('https://6c43-2405-201-c026-70ef-69e4-42d1-4975-4792.ngrok-free.app/adminlogin/', {
                        username: this.username,
                        password: this.password,
                        remember_me: this.rememberMe
                    });
                        
                    if (response.data.success) {
                        localStorage.setItem('access_token', response.data.access_token);
                        localStorage.setItem('refresh_token', response.data.refresh_token);
                        this.$router.push('/admin/dashboard');
                    }
                    else if (response.data.blocked){
                          this.errorMessage = response.data.error_message;

                    }
                } catch (error) {
                    this.errorMessage = error.response?.data?.error_message || 'Login failed';
                    console.error('Login failed:', error);
                }
            },
        }
    };
</script>

<style scoped>
.login-container-div {
  margin: 0;
  padding: 0;
  font-family: 'Poppins', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  color: #ffffff;
  background-color: #0d0d11;
}
.error-message{
    color: #bb2e2e;
    margin: 10px;
}

.login-container {
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  border-radius: 10px;
  padding: 40px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  width: 350px;
  background: rgba(255, 255, 255, 0.19);
  border-radius: 16px;
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(6.6px);
  -webkit-backdrop-filter: blur(6.6px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.19);
  border-radius: 16px;
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(6.6px);
  -webkit-backdrop-filter: blur(6.6px);
  border: 1px solid #1b212d;
  background: linear-gradient(to bottom, #2f3543, #1b212d);
}

.login-container h2 {
  margin-bottom: 30px;
  font-size: 28px;
  font-weight: 600;
}

.form1 {
  width: 100%;
}

.form-group {
  position: relative;
  margin-bottom: 20px;
}

.form-group input {
  width: 100%;
  padding: 14px 40px 14px 15px;
  border: none;
  border-radius: 30px;
  font-size: 14px;
  color: #ffffff;
  background: rgba(255, 255, 255, 0.2);
  outline: none;
}

.form-group input::placeholder {
  color: #ffffffb3;
}
.form-group .username-icon,
.form-group .toggle-password {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  right: 15px;
  color: #ffffffb3;
}
.form-group .toggle-password {
  cursor: pointer;
}
.form1 {
  width: 100%;
}

.form-group {
  position: relative;
  margin-bottom: 30px;
}
#password-field{
  margin-bottom: 20px;
}
.forgot-password{
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
}
.forgot-password a{
  text-decoration: none;
  color: #ffffff;
}
input[type="text"],
input[type="password"] {
  width: 100%;
  padding: 15px 20px;
  border-radius: 30px;
  box-sizing: border-box;
  font-size: 16px;
  letter-spacing: 0px;

}
.forgot-password {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  margin-bottom: 20px;
}

.forgot-password a {
  text-decoration: none;
  color: #ffffffb3;
  transition: color 0.3s;
}

.forgot-password a:hover {
  color: #ffffff;
  text-decoration: underline;
}

.btn-login {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  font-weight: 600;
  color: #333;
  background: #ffffff;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  transition: background 0.3s ease-in-out;
} 

.btn-login:hover {
  background: #64a8eb;
  color: #ffffff;
}

.btn-login:disabled {
  background: #ccc;
  cursor: not-allowed;
  color: #333;
}
.animation{
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  transform: translateY(-40px);
}
.animation path {
  stroke-dasharray: 1000; 
  stroke-dashoffset: 1000; 
  animation: drawAndErase 2.5s linear infinite; 
}

@keyframes drawAndErase {
  0% {
      stroke-dashoffset: 1000; 
  }
  50% {
      stroke-dashoffset: 0; 
  }
  100% {
      stroke-dashoffset: -1000; 
  }
}
</style>